using System.Net.Mime;
using System.Runtime.CompilerServices;
using System.Security.Cryptography.X509Certificates;
using System.Text;

namespace Mod3ASPNET.Filters
{
     public class LoggingFilter : IEndpointFilter
     {
          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                                   Fields                                                                         !
          //                                                                                                                                                  !
          // ==================================================================================================================================================
          private readonly ILogger<LoggingFilter> _logger;





          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                                Constants                                                                         !
          //                                                                                                                                                  !
          // ==================================================================================================================================================





          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                                Properties                                                                        !
          //                                                                                                                                                  !
          // ==================================================================================================================================================





          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                                  Indexers                                                                        !
          //                                                                                                                                                  !
          // ==================================================================================================================================================





          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                                   Events                                                                         !
          //                                                                                                                                                  !
          // ==================================================================================================================================================





          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                                 Constructors                                                                     !
          //                                                                                                                                                  !
          // ==================================================================================================================================================
          public LoggingFilter(ILogger<LoggingFilter> p_logger)
          {
               _logger = p_logger;
          }





          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                              Synchronous methods                                                                 !
          //                                                                                                                                                  !
          // ==================================================================================================================================================





          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                             Asynchronous methods                                                                 !
          //                                                                                                                                                  !
          // ==================================================================================================================================================
          // Filter (implémentation de l'interface 'IEndpointFilter' dont hérite cette classe 'LoggingFilter' -------------------------------------------------
          public async ValueTask<object?> InvokeAsync(EndpointFilterInvocationContext context, EndpointFilterDelegate next)
          {
               //var logger = context.HttpContext.RequestServices.GetService<ILogger<Program>>();                                                               // Comme je suis dans une classe, je n'ai pas besoin de récupérer l'information depuis le HttpContext
                                                                                                                                                                // Je peux en effet l'avoir directement dans le constructeur, ce qui permet l'injection de dépendance
               
               _logger.LogInformation($"Nous commençons l'Endpoint POST avec la route {context.HttpContext.Request.Path}");

               var result = await next(context);                                                                                                                // Exécution de l'Endpoint proprement dit

               _logger.LogInformation($"Nous finissons l'Endpoint POST avec la route {context.HttpContext.Request.Path}");

               return result;
          }





          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                         Standard operators redefined                                                             !
          //                                                                                                                                                  !
          // ==================================================================================================================================================
          // Unary operators ----------------------------------------------------------------------------------------------------------------------------------



          // Binary operators ---------------------------------------------------------------------------------------------------------------------------------



          // Conversion operators -----------------------------------------------------------------------------------------------------------------------------





          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                           Standard methods redefined                                                             !
          //                                                                                                                                                  !
          // ==================================================================================================================================================
          // ToString() ---------------------------------------------------------------------------------------------------------------------------------------



          // Equals() -----------------------------------------------------------------------------------------------------------------------------------------



          // HashCode() ---------------------------------------------------------------------------------------------------------------------------------------





          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                                  Nested types                                                                    !
          //                                                                                                                                                  !
          // ==================================================================================================================================================





          // ==================================================================================================================================================
          //                                                                                                                                                  !
          //                                                                    Finalizer                                                                     !
          //                                                                                                                                                  !
          // ==================================================================================================================================================
          // Unmanaged resources ------------------------------------------------------------------------------------------------------------------------------
     }
}
